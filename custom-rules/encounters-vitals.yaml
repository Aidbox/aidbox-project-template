aidbox.ccda.rules.encounters/narrative:
  select:
    - selector:
        cda:  [text 0 cols 1]
        fhir: [entry * type 0]
      override:
        cda:  [text 0 cols 1]
        fhir: [entry * class]
    - selector:
        cda: [text 0 cols 2]
        fhir: [entry * location 0 location address]
      override:
        cda: [text 0 cols 2]
        fhir: [entry * location 0 location type 0]
aidbox.ccda.rules.shared.encounter/rules:
  select:
    - selector:
        cda: [code]
        fhir: [type 0]
        id: enc-code
      override:
        cda: [code]
        fhir: [class]
        cda/default:
          -nullFlavor: UNK
          cda/type: const
  remove:
    - selector:
        fhir: [class]
aidbox.ccda.rules.results/narrative:
  replace:
    - cda: [text 0]
      const:
        type: table
        header:
          - Code
          - Value
          - Date
          - Reference Range
    - fhir: [entry 0 hasMember *]
      cda: [text 0 rows]
      apply-rules:
        - cda: [0]
          fhir: [code]
        - cda: [1]
          fhir: [value]
        - cda: [2]
          fhir: [effective]
        - cda: [3]
          fhir: [referenceRange]
aidbox.ccda.rules.problems/narrative:
  replace:
    - cda: [text 0]
      const:
        type: table
        caption:
          - Problems
        header:
          - Problem
          - Noted Date
          - Diagnosed Date
    - fhir: [entry *]
      cda: [text 0 rows]
      apply-rules:
        - fhir: [code]
          cda: [0]
        - fhir: [onset]
          cda: [1]
        - fhir: [recordedDate]
          cda: [2]
aidbox.ccda.rules.allergies/narrative:
  select:
    - selector:
        cda: [text 0 cols 0]
        fhir: [entry * type]
      override:
        cda:  [text 0 cols 0]
        fhir: [entry * category 0]
        cda/default:
          -nullFlavor: UNK
          cda/type: const
aidbox.ccda.rules.vital-signs/narrative:
  replace:
    - cda: [text 0]
      const:
        type: table
        header:
          - Vital sign
          - Date
          - Value and units
    - fhir: [entry *]
      cda: [text 0 rows]
      apply-rules:
        - fhir: [code]
          cda: [0]
        - fhir: [effective]
          cda: [1]
        - fhir: [value]
          cda: [2]
